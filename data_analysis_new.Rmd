---
title: "Разведанализ данных"
output:
  html_document:
    df_print: paged
  pdf_document: default
---

В исследовании мы используем усредненные данные по **50 штатам США с 2010 по 2019 год.**

Чтобы изучить экономические условия штата, мы включили такие характеристики как количество совершенных насильственных преступлений, уровень бедности и безработицы, а также доход и реальный ВВП населения.

Данные были собраны с разных ресурсов, так что требовали некоторых преобразований для дальнейшего анализа.

Предварительный просмотр данных:

```{r message = FALSE, warning=FALSE, echo = F, comment = ""}
library(readr)
id = "1m4iUqrvzF0AA-P4l0iU4PYoD7LiyjVt8"
crime = read.csv(sprintf("https://drive.google.com/uc?id=%s&export=download", id))

library(dplyr)
crime = crime %>% select(-X)

library(knitr)
library(ggplot2)
library(lmtest)

library(DT)
datatable(head(crime))
```

Для подробного анализа мы также проверили корреляцию между зависимой переменной Vcrime и объясняющими переменными:

```{r message = FALSE, warning=FALSE, echo = F, comment = ""}
library(stats)
as.dist(round(cor(crime[,2:6]),5))
```



# Рассмотрим обощающие данные по всем переменным:

## Переменная State

```{r message = FALSE, warning=FALSE, echo = F, comment = ""}
summary(crime$State)
```

Текстовая переменная, обозначающая название штата. 

```{r message = FALSE, warning=FALSE, echo = F, comment = ""}
unique(crime$State)
```

Имеет 50 уникальных значений.


## Переменная Vcrime

```{r message = FALSE, warning=FALSE, echo = F, comment = ""}
summary(crime$Vcrime)
```

Числовая переменная, указывающая количество совершенных насильственных преступлений (violent crimes) на 100 тысяч населения.

Значения колеблются в диапазоне от 122 до 703, где среднее (363) и медианное (337) близки друг к другу.

```{r message = FALSE, warning=FALSE, echo = F, comment = ""}
library(ggplot2)
ggplot() +
  geom_histogram(data = crime, mapping = aes(x = Vcrime), fill="lightcoral", col="red") +
  ggtitle("Распределение количества совершенных насильственных \nпреступлений") + 
  xlab("Число преступлений") + 
 	ylab("Плотность") + 
  theme(plot.title = element_text(lineheight = .8),
    axis.text = element_text(colour = 'black'),
    axis.text.x = element_text(size = 8, hjust = 1)) + 
  theme_bw()
```

На графике видно, что количество регистрируемых наблюдений в целом находится на достаточно высоком уровне, что еще раз подтверждает выводы СМИ о существующей проблеме с насильственными преступлениями на территории Соединенных Штатов Америки. Статистические службы также зафиксировали и несколько экстремально высоких значений за все время наблюдения (более 600 преступлений). Подобные выбросы можно объяснить снижением затрат на финансирование правоохранительных органов, усилением расслоения общества, экономическими шоками. Следует заметить, что это могло произойти и вследствие ошибок при фиксации и регистрации насильственных преступлений.


## Переменная PR

```{r message = FALSE, warning=FALSE, echo = F, comment = ""}
summary(crime$PR)
```

Poverty rate - числовая переменная, обозначающая уровень бедности в долях, то есть от 0 до 1.

В нашем случае минимальное значение 0.0818, а максимальное 0.2173.

Коэффициент корреляции с переменной Vcrime равен 0.417, что говорит о несильной положительной взаимосвязи.

На графике рассеивания мы также можем заметить этот тренд:

```{r message = FALSE, warning=FALSE, echo = F, comment = ""}
crime %>%
  ggplot(aes(PR, Vcrime)) + 
  geom_point(size = 2, shape = 15, color = "red") + 
  geom_smooth(method = "lm", formula = y ~ x, color = "blue") +
  ggtitle("Распределение уровня бедности населения для штатов \nс разным уровнем преступности") + 
  xlab("Уровень бедности") + 
 	ylab("Число преступлений") +
  theme_bw()
```

Дополнительно построим парную регрессию между переменными:

```{r message = FALSE, warning=FALSE, echo = F, comment = ""}
lm1 = lm(Vcrime ~ PR, data = crime)
coeftest(lm1)
```

P-value равно 0.00259, что говорит о значимости взаимосвязи между этими переменными.

Также проверим распределение данных на гетероскедастичность с помощью теста Бройша-Пагана, так как график был не однозначен, а наличие этого признака может помешать при дальнейшей оценке.

```{r message = FALSE, warning=FALSE, echo = F, comment = ""}
bptest(lm1)
```

В силу большого p-value в данном случае гипотеза об условной гомоскедастичности не отвергается, то есть гетероскедастичности нет.

Что касается данных в целом, почти все штаты показывают неплохие - относительно мировых - результаты по уровню бедности. Тем не менее, есть штаты, которые за десять лет наблюдений все так же имеют достаточно высокую (близко к 0,2 и выше) долю населения, находящегося за чертой бедности. Это может объясняться локальными экономическими, географическими и климатическими особенностями, которые мешают развитию штата. 


## Переменная UR

```{r message = FALSE, warning=FALSE, echo = F, comment = ""}
summary(crime$UR)
```

Unemployment rate - уровень безработицы в штатах в долях. Значения колеблются от 2,9% до 8,3%.

Коэффициент корреляции с переменной Vcrime равен 0.46, что говорит о слабой положительной взаимосвязи.

Точечный график показывает похожую информацию:

```{r message = FALSE, warning=FALSE, echo = F, comment = ""}
crime %>%
  ggplot(aes(UR*100, Vcrime)) + 
  geom_point(size = 2, shape = 17, color = "green") + 
  geom_smooth(method = "lm", formula = y ~ x, color = "yellow") +  
  ggtitle("Распределение уровня безработицы среди населения") + 
  xlab("Уровень безработицы (%)") + 
 	ylab("Число преступлений") +
  theme_bw()
```

Проверим дополнительно взаимосвязь между переменными в парной регрессии: 

```{r message = FALSE, warning=FALSE, echo = F, comment = ""}
lm2 = lm(Vcrime ~ UR, data = crime)
coeftest(lm2)
```

P-value равно 0.000776 - подтверждаем гипотезу о взаимосвязи.

Также проведем тест Бройша-Пагана, аналогично первому случаю:

```{r message = FALSE, warning=FALSE, echo = F, comment = ""}
bptest(lm2)
```

P-value достаточно велик, чтобы не отвергать гипотезу и утверждать, что гетероскедастичности здесь нет.

Следует также заметить, что уровень безработицы в США в среднем держится на оптимальном уровне, потому что падения ниже 5%, как правило, приводят к снижению общего уровня выпуска и усилению инфляции. Подобные значения также говорят об эффективности работы Федеральной Резервной Системы.


## Переменная PIPC 

```{r message = FALSE, warning=FALSE, echo = F, comment = ""}
summary(crime$PIPC)
```

Personal income per capita - числовое значение, выражающее доход на душу населения в долларах.

Максимальное значение (67553) почти в два раза больше минимального (35163), хотя среднее и медианное значения - чуть больше 45000. То есть значений, близких к максимальному, довольно мало.

Коэффициент корреляции с Vcrime слишком мал, а значение p-value в парной регрессии слишком велико, чтобы говорить о сильной значимости взаимосвязи переменных:

```{r message = FALSE, warning=FALSE, echo = F, comment = ""}
lm3 = lm(Vcrime ~ PIPC, data = crime)
coeftest(lm3)
```

Рассмотрим график типа boxplot:

```{r message = FALSE, warning=FALSE, echo = F, comment = ""}
ggplot(crime) +
  geom_boxplot(aes(y = PIPC), color = "blue") +
  ggtitle("Распределение дохода населения") + 
 	ylab("Уровень дохода") + 
  theme_bw()
```

Уровень дохода приходится в основном на промежуток от 43 до 51 тысячи долларов на душу населения. Это позволяет сделать вывод о том, что доходы жителей большинства штатов находятся именно в этом отрезке. 

Тем не менее присутствует значение, которое выделяется из массы остальных. Проверим штаты с уровнем дохода больше 60000:

```{r message = FALSE, warning=FALSE, echo = F, comment = ""}
datatable(crime %>% filter(PIPC > 60000) %>% arrange(desc(PIPC)) %>% select(State, PIPC))
```

Выброс в данных - значение уровня дохода в штате Коннектикут. Детально изучив составляющие экономики штата мы сделали вывод, что большую долю в ней составляет доход от военно-промышленных корпораций, так как Коннектикут - главный арсенал страны, а также страховой бизнес - один из наиболее популярных в штате.

Массачусетс - один из мировых центров биотехнологий, искусственного интеллекта и венчурного капитала. Большинство рейтингов ставят данный штат в список лучших для ведения бизнеса. Совокупность этих факторов позволяет ему быть в числе лидеров по показателю дохода на душу населения, хоть это и не является выбросом, судя по графику.

Выбросы можно объяснить спецификой показателя дохода: он фиксирует все доходы человека (зарплата, доходы от аренды, дивиденды, трансферты и другие виды). Это приводит к следующей ситуации: в маленьких штатах показатель PIPC может быть либо слишком высоким, либо слишком низким из-за небывалой урожайности, природной катастрофы или крупного экономического проекта. В то же время дополнительное население (например, студенты колледжей из других штатов) может занижать показатели PIPC.

Скорее всего, видимый выброс в данном случае влияет на корреляцию между переменными, так что попробуем прологарифмировать значение PIPC. Логарифм делает показатели относительными, что позволяет избавиться от выбросов.

```{r message = FALSE, warning=FALSE, echo = F, comment = ""}
crime = crime %>% mutate(logPIPC = log(PIPC))

ggplot(crime) +
  geom_boxplot(aes(y = logPIPC), color = "blue") +
  ggtitle("Распределение дохода населения") + 
 	ylab("Логарифм уровня дохода") + 
  theme_bw()
```

Мы видим, что таким образом получилось избавиться от выброса.

```{r message = FALSE, warning=FALSE, echo = F, comment = ""}
lm3_ = lm(Vcrime ~ logPIPC, data = crime)
coeftest(lm3_)

as.dist(round(cor(crime[,2:7]),5))
```

Однако увеличить значимость при этом не удалось. Показатель p-value сдвинулся в меньшую сторону совсем мало, а показатель корреляции в свою очерель поменял знак, но по модулю чуть увеличился. Поэтому в дальнейшем будем использовать именно логарифм дохода населения.

В рамках показателя Personal Income per Capita наблюдается положительная тенденция: усреднённые за 10 лет данные показывают, что доход на душу населения находится на достаточно высоком уровне почти во все штатах, что свидетельствует о приемлемом состоянии экономики. Кроме того, следует отметить, что подобные показатели достигаются, в том числе, благодаря западной контрактной системе с фиксированными почасовыми ставками.


## Переменная RGDP

```{r message = FALSE, warning=FALSE, echo = F, comment = ""}
summary(crime$RGDP)
```

Real GDP - числовое значение реального ВВП штата. За 10 лет он колеблется от 29180 до 2335826.

Аналогично предыдущему результату нельзя говорить о значимости переменной из-за низкого коэффициента корреляции и большого p-value в парной регрессии.

```{r message = FALSE, warning=FALSE, echo = F, comment = ""}
lm4 = lm(Vcrime ~ RGDP, data = crime)
coeftest(lm4)
```

Максимальное значение = 2335826, а значение 3го квартиля = 442790. Это говорит об очень сильных выбросах. Посмотрим график boxplot:

```{r message = FALSE, warning=FALSE, echo = F, comment = ""}
ggplot(crime) +
  geom_boxplot(aes(y = RGDP), color = "dark green") +
  ggtitle("Распределение реального ВВП") + 
 	ylab("Значение реального ВВП") + 
  theme_bw()
```

Тут видны выбросы в лице предположительно 3 штатов. Проверим:

```{r message = FALSE, warning=FALSE, echo = F, comment = ""}
datatable(crime %>% filter(RGDP > 700000) %>% arrange(desc(RGDP)) %>% select(State, RGDP))
```

Действительно, мы видим, что 3 штата - Калифорния, Техас и Нью-Йорк - отличаются от других штатов тем, что средний реальный ВВП с 2010 по 2019 год был выше 1300000, а у остальных штатов значительно ниже. 

Нетрудно объяснить подобное отклонение реального ВВП: 

+ Калифорния - крупнейшая экономика в рамках Соединенных Штатов Америки, пятая по показателям ВВП даже среди стран. Одними из драйверов подобного успеха являются численность населения и диверсификация экономики (финансовый сектор и недвижимость, информационная отрасль, производственный сектор вносят наибольший вклад).

+ Экономика Техаса - вторая по размерам после калифорнийской. Данный штат стремительно развивается уже многие годы, и это однозначно отражается на его показателях: первое место по темпам роста ВВП, первое место по экспорту в США. Экономика Техаса во многом зависит от торговли и обилия крупного бизнеса.

+ Стоит отметить и экономику штата Нью-Йорк - третью по размерам в США и двенадцатую - по всему миру. Штат является центром всех финансовых операций: подтверждением тому служит Нью-Йоркская фондовая биржа. Кроме того, Нью-Йорк - крупный морской порт.

Однако эти выбросы снова могут отрицательно повлиять на наши будущие оценки, поэтому логарифмируем переменную.

```{r message = FALSE, warning=FALSE, echo = F, comment = ""}
crime = crime %>% mutate(logRGDP = log(RGDP))

ggplot(crime) +
  geom_boxplot(aes(y = logRGDP), color = "dark green") +
  ggtitle("Распределение реального ВВП") + 
 	ylab("Логарифм реального ВВП") + 
  theme_bw()
```

От выбросов избавились. Проверим числовые показатели:

```{r message = FALSE, warning=FALSE, echo = F, comment = ""}
lm4_ = lm(Vcrime ~ logRGDP, data = crime)
coeftest(lm4_)

as.dist(round(cor(crime[,2:8]),5))
```

Нельзя сказать, что данные значительно изменились, но все же показатели стали ближе к тем, что гарантируют значимость. Именно поэтому мы будем использовать логарифм реального ВВП в дальнейшей модели.

В рамках Real GDP наблюдается тенденция к росту показателя в зависимости от размера и численности населения штата, его ранга бизнес-среды, скопления высокотехнологичных производств и размерности рынка венчурного капитала.


# Общий вывод

Нам удалось собрать датасет с усредненными данными за обширный период времени, на основе которого мы сможем проверить нашу гипотезу о наличии зависимости между экономическими условиями штата и количеством насильственных преступлений в нем. В рамках разведанализа нам удалось провести необходимую чистку и изменение данных и убедиться в правильности выбора переменных в рамках нашего исследования. 
