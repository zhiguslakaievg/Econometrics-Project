---
title: "Регрессионный анализ"
output:
  html_document:
  pdf_document: default
---

### Данные

```{r message = FALSE, warning=FALSE, echo = F, comment = ""}
library(dplyr)
library(stringr)
library(car)
library(stargazer)
library(lmtest)
library(broom)
library(sandwich)
library(tidyverse)
library(kableExtra)
install.packages('formattable')
library(formattable)
library(gt)
library(glue)

# загрузка файла 
library(readr)
id = "1cSP1bx8LthjcTPf4xya70n6cGUrVTPHC"
crime = read.csv(sprintf("https://drive.google.com/uc?id=%s&export=download", id))
```

### Модели

```{r message = FALSE, warning=FALSE, echo = F, comment = ""}
# задаем модели
model_4 = lm(Vcrime ~ PR + UR + log(PIPC) + log(RGDP) + Density + Marriage + Immigrants + Temperature + Divorce, data = crime)
model_1 = lm(Vcrime ~ PR + UR + log(PIPC) + log(RGDP), data = crime)
model_3 = lm(Vcrime ~ PR + UR + log(PIPC) + log(RGDP) + Density + Marriage + Immigrants, data = crime)
model_2 = lm(Vcrime ~ PR + UR + log(PIPC) + log(RGDP) + Density, data = crime)
# считаем коэффициенты регрессии
coef1 = coeftest(model_1, df = Inf, vcov = vcovHC, type = 'HC0')
coef2 = coeftest(model_2, df = Inf, vcov = vcovHC, type = 'HC0')
coef3 = coeftest(model_3, df = Inf, vcov = vcovHC, type = 'HC0')
coef4 = coeftest(model_4, df = Inf, vcov = vcovHC, type = 'HC0')
# создаем единую таблицу с коэффициентами
stargazer(coef1, coef2, coef3, coef4, type='text')
```

В первой модели (четыре изначально предпологаемые переменные) нулевая гипотеза отвергается только для PR.

Благодаря появлению контрольных переменных Н0 отвергается еще и для PIPC (модель 4), но только на уровне значимости 5%.

Также, нулевая гипотеза отвергается для экономического состояния в целом на любом уровне значимости.

```{r message = FALSE, warning=FALSE, echo = F, comment = ""}
reg0 = lm(Vcrime ~ PR + UR + log(PIPC) + log(RGDP) + Density + Marriage + Immigrants + Temperature + Divorce, data = crime)
reg1 = lm(Vcrime ~ UR + log(PIPC) + log(RGDP) + Density + Marriage + Immigrants + Temperature + Divorce, data = crime)
reg2 = lm(Vcrime ~ PR + log(PIPC) + log(RGDP) + Density + Marriage + Immigrants + Temperature + Divorce, data = crime)
reg3 = lm(Vcrime ~ PR + UR + log(RGDP) + Density + Marriage + Immigrants + Temperature + Divorce, data = crime)
reg4 = lm(Vcrime ~ PR + UR + log(PIPC) + Density + Marriage + Immigrants + Temperature + Divorce, data = crime)
reg5 = lm(Vcrime ~ Density + Marriage + Immigrants + Temperature + Divorce, data = crime)
# проведем тесты Вальда
lmtest::waldtest(reg1, reg0, test = "Chisq", vcov = vcovHC(reg0, type = "HC0"))
lmtest::waldtest(reg2, reg0, test = "Chisq", vcov = vcovHC(reg0, type = "HC0"))
lmtest::waldtest(reg3, reg0, test = "Chisq", vcov = vcovHC(reg0, type = "HC0"))
lmtest::waldtest(reg4, reg0, test = "Chisq", vcov = vcovHC(reg0, type = "HC0"))
lmtest::waldtest(reg5, reg0, test = 'Chisq', vcov = vcovHC(reg0, type = 'HC0'))
```

Согласно нашей модели, на уровне значимости 5% значимыми являются следующие переменные:

* Уровень бедности 
* Логарифм дохода на душу населения (является значимой на уровне значимости 1%)

Затем, мы провели несколько тестов Вальда для проверки гипотезы, и они подтвердили наши результаты: нулевая гипотеза отвергается только для переменных PR и PIPC.

Также, мы провели отдельный тест Вальда, чтобы проверить, значимы ли в целом наши переменные интереса. Согласно этому тесту, экономический статус значим на уровне значимости 1%.